"0","# This code block creates a plot matrix comparing the actual body mass box plot (upper right) to those obtained from many permutations"
"0",""
"0","# Build a tibble to store the data, beginning with the actual data"
"0","perm_tibble <- penguins %>% select(species,body_mass_g)"
"0","# Set the number of permutations, here 24 for better viewing "
"0","n_reps <- 24"
"0","# Grow the tibble column by column with permuted values"
"0","for (i in 1:n_reps)"
"0","{"
"0","    # Name the permutation reps P1,P2,..."
"0","    new_name <- paste(""P"",i,sep="""")"
"0","    # Generate a permuted column of body mass values. Note that this is equivalent     to permuting the species labels; however, permuting values makes the plotting     easier"
"0","    new_col <- tibble(penguins$body_mass_g[sample(length(penguins$species))])"
"0","    # Assign the new column its name"
"0","    colnames(new_col) <- new_name"
"0","    # Attach the permuted column to the end of the growing tibble"
"0","    perm_tibble <- cbind(perm_tibble,new_col)"
"0","}"
"0","# Record the order of the column names for later use as plot order"
"0","factor_levels <- colnames(perm_tibble)[2:(n_reps+2)]"
"0","# Pivot the tibble built above into long form"
"0","plot_tibble <- pivot_longer(perm_tibble,cols=2:(n_reps+2),names_to = c(""rep""))"
"0","# Turn the rep column into a factor, using the order stored above"
"0","plot_tibble$rep <- factor(plot_tibble$rep,levels=factor_levels)"
"0","# Plot a matrix of box plots, beginning with the real data, followed from left to right with P1,P2,etc. Set the number of columns in the plot matrix to 5 for viewing. Remove the x-axis annotations."
"0","ggplot(plot_tibble,aes(x=species,y=value,colour=species))+geom_boxplot()+facet_wrap(~rep,ncol=5)+theme(axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())"
